<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>루 식단 관리 🐱</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/lucide@latest/dist/lucide.css">
    <style>
        /* 모바일 최적화 스타일 */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .lucide {
            width: 20px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Lucide 아이콘 컴포넌트
        const Icon = ({ name, className = "" }) => {
            const icons = {
                Calendar: "📅",
                Weight: "⚖️",
                Droplet: "💧",
                Check: "✓",
                Plus: "➕",
                BarChart3: "📊",
                Settings: "⚙️"
            };
            return <span className={className}>{icons[name] || "•"}</span>;
        };

        const CatDietTracker = () => {
            // 현재 날짜 (KST)
            const today = new Date();
            const dateString = `${today.getMonth() + 1}/${today.getDate()} ${['일', '월', '화', '수', '목', '금', '토'][today.getDay()]}요일`;

            // 루의 나이 자동 계산
            const calculateAge = (birthDate) => {
                const birth = new Date(birthDate);
                const now = new Date();
                const monthDiff = (now.getFullYear() - birth.getFullYear()) * 12 + (now.getMonth() - birth.getMonth());
                const dayDiff = now.getDate() - birth.getDate();
                
                if (monthDiff < 12) {
                    return `${monthDiff}개월 ${dayDiff > 0 ? Math.floor(dayDiff / 7) + '주' : ''}`;
                } else {
                    const years = Math.floor(monthDiff / 12);
                    const months = monthDiff % 12;
                    return `${years}살 ${months > 0 ? months + '개월' : ''}`;
                }
            };

            // 루의 기본 정보
            const [catInfo, setCatInfo] = useState({
                name: '루',
                birthDate: '2025-03-21',
                weight: 1.78,
                age: calculateAge('2025-03-21'),
                targetCalories: 350
            });

            // 식단 계획
            const [dietPlan, setDietPlan] = useState({
                morning: {
                    time: '07:00~09:00',
                    wet: 25,
                    dry: 8,
                    snack: 0,
                    notes: '어제 못 먹은 분량 고려해서 습식 비중 높임'
                },
                lunch: {
                    time: '12:00~14:00',
                    wet: 15,
                    dry: 12,
                    snack: 3,
                    notes: '초미니 트릿 2~3g (선택) - 외출 대비 건식 포함'
                },
                dinner: {
                    time: '18:00~20:00',
                    wet: 30,
                    dry: 10,
                    snack: 0,
                    notes: '츄르 1/3개 (식욕 유도용, 선택사항)'
                }
            });

            // 실제 섭취 기록
            const [actualIntake, setActualIntake] = useState({
                morning: { wet: 0, dry: 0, snack: 0, done: false },
                lunch: { wet: 0, dry: 0, snack: 0, done: false },
                dinner: { wet: 0, dry: 0, snack: 0, done: false }
            });

            // 체중 기록 (날짜별)
            const [weightHistory, setWeightHistory] = useState(() => {
                const saved = localStorage.getItem('weightHistory');
                return saved ? JSON.parse(saved) : {
                    [today.toISOString().split('T')[0]]: 1.78
                };
            });

            // 일일 식단 기록 저장
            const [dailyRecords, setDailyRecords] = useState(() => {
                const saved = localStorage.getItem('dailyRecords');
                return saved ? JSON.parse(saved) : {};
            });

            // 체중 업데이트
            const updateWeight = (newWeight) => {
                const todayKey = today.toISOString().split('T')[0];
                const updatedHistory = {
                    ...weightHistory,
                    [todayKey]: newWeight
                };
                setWeightHistory(updatedHistory);
                localStorage.setItem('weightHistory', JSON.stringify(updatedHistory));
                setCatInfo({...catInfo, weight: newWeight});
            };

            // 수분 섭취 및 화장실 (0: 안마심, 1: 조금, 2: 충분)
            const [waterIntake, setWaterIntake] = useState(0);
            const [bathroomCheck, setBathroomCheck] = useState(false);

            // 현재 탭
            const [activeTab, setActiveTab] = useState('today');

            // AI 식단 생성 요청
            const [showAIInput, setShowAIInput] = useState(false);
            const textareaRef = useRef(null);
            const [geminiApiKey, setGeminiApiKey] = useState(() => 
                localStorage.getItem('geminiApiKey') || ''
            );

            // AI 입력창 토글
            const toggleAIInput = () => {
                setShowAIInput(!showAIInput);
                if (!showAIInput) {
                    setTimeout(() => {
                        if (textareaRef.current) {
                            textareaRef.current.focus();
                        }
                    }, 100);
                }
            };

            // Gemini AI 식단 생성
            const handleAIRequest = async () => {
                const requestText = textareaRef.current?.value || '';
                if (!requestText.trim()) {
                    alert('요청 내용을 입력해주세요!');
                    return;
                }
                
                if (!geminiApiKey) {
                    alert('설정에서 Gemini API 키를 입력해주세요!');
                    setActiveTab('settings');
                    return;
                }

                try {
                    const prompt = `
당신은 고양이 루의 식단 관리 전문가입니다. 
루의 정보:
- 이름: ${catInfo.name}
- 체중: ${catInfo.weight}kg
- 나이: ${catInfo.age} (생일: ${catInfo.birthDate})
- 하루 목표 칼로리: ${catInfo.targetCalories}kcal
- 현재 시간: ${new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}

사용자 요청: "${requestText}"

위 정보를 바탕으로 오늘의 식단을 생성해주세요. 
중요: 
- 3개월 정도의 아기 고양이는 보통 하루 4-5끼를 먹습니다
- 필요에 따라 morning, lunch, dinner 외에 snackTime1, snackTime2 등을 추가할 수 있습니다
- 사용자 요청에 따라 식사 횟수를 조절하세요

다음 형식의 JSON으로만 응답해주세요. 설명이나 다른 텍스트는 포함하지 마세요:
{
  "morning": {
    "time": "07:00~09:00",
    "wet": 25,
    "dry": 8,
    "snack": 0,
    "notes": "참고사항"
  },
  "lunch": {
    "time": "12:00~14:00",
    "wet": 15,
    "dry": 12,
    "snack": 3,
    "notes": "참고사항"
  },
  "dinner": {
    "time": "18:00~20:00",
    "wet": 30,
    "dry": 10,
    "snack": 0,
    "notes": "참고사항"
  }
}

칼로리 계산: 습식 1g = 1.2kcal, 건식 1g = 3.5kcal, 간식 1g = 4kcal
반드시 유효한 JSON 형식으로만 응답하세요.`;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${geminiApiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 1000,
                            }
                        })
                    });

                    if (!response.ok) {
                        throw new Error('API 요청 실패');
                    }

                    const data = await response.json();
                    const content = data.candidates[0].content.parts[0].text;
                    
                    // JSON 추출 (백틱이나 다른 텍스트 제거)
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('올바른 JSON 형식이 아닙니다');
                    }
                    
                    const newDietPlan = JSON.parse(jsonMatch[0]);
                    
                    // 식단 업데이트
                    setDietPlan(newDietPlan);
                    
                    // actualIntake도 새로운 식사 시간에 맞게 초기화
                    const newActualIntake = {};
                    Object.keys(newDietPlan).forEach(mealTime => {
                        newActualIntake[mealTime] = { wet: 0, dry: 0, snack: 0, done: false };
                    });
                    setActualIntake(newActualIntake);
                    
                    // 입력창 닫기
                    setShowAIInput(false);
                    if (textareaRef.current) {
                        textareaRef.current.value = '';
                    }
                    
                    alert('✅ 새로운 식단이 생성되었습니다!');
                } catch (error) {
                    console.error('AI 요청 오류:', error);
                    alert('❌ 식단 생성 중 오류가 발생했습니다.\n' + error.message);
                }
            };

            // 칼로리 계산 (대략적인 값)
            const calculateCalories = (wet, dry, snack) => {
                return Math.round(wet * 1.2 + dry * 3.5 + snack * 4);
            };

            // 총 계획 칼로리
            const totalPlannedCalories = Object.values(dietPlan).reduce((sum, meal) => 
                sum + calculateCalories(meal.wet, meal.dry, meal.snack), 0
            );

            // 실제 섭취 칼로리
            const totalActualCalories = Object.values(actualIntake).reduce((sum, meal) => 
                sum + calculateCalories(meal.wet, meal.dry, meal.snack), 0
            );

            // 오늘의 기록 저장
            useEffect(() => {
                const todayKey = today.toISOString().split('T')[0];
                const todayRecord = {
                    date: todayKey,
                    dietPlan,
                    actualIntake,
                    waterIntake,
                    bathroomCheck,
                    weight: catInfo.weight,
                    totalCalories: totalActualCalories
                };
                
                const updatedRecords = {
                    ...dailyRecords,
                    [todayKey]: todayRecord
                };
                
                setDailyRecords(updatedRecords);
                localStorage.setItem('dailyRecords', JSON.stringify(updatedRecords));
            }, [dietPlan, actualIntake, waterIntake, bathroomCheck, catInfo.weight]);

            // 식사 체크 핸들러
            const handleMealCheck = (mealTime) => {
                setActualIntake(prev => ({
                    ...prev,
                    [mealTime]: {
                        ...prev[mealTime],
                        done: !prev[mealTime].done,
                        wet: !prev[mealTime].done ? dietPlan[mealTime].wet : 0,
                        dry: !prev[mealTime].done ? dietPlan[mealTime].dry : 0,
                        snack: !prev[mealTime].done ? dietPlan[mealTime].snack : 0
                    }
                }));
            };

            // 오늘의 식단 탭
            const TodayTab = () => (
                <div className="space-y-4">
                    {/* 헤더 정보 */}
                    <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg">
                        <div className="flex items-center justify-between">
                            <div>
                                <h2 className="text-2xl font-bold flex items-center gap-2">
                                    🐾 {catInfo.name} 식단
                                </h2>
                                <p className="text-sm opacity-90">{dateString}</p>
                            </div>
                            <div className="text-right">
                                <p className="text-sm">체중: {catInfo.weight}kg</p>
                                <p className="text-sm">{catInfo.age}</p>
                            </div>
                        </div>
                    </div>

                    {/* AI 식단 생성 버튼 */}
                    <button
                        onClick={toggleAIInput}
                        className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg flex items-center justify-center gap-2 hover:opacity-90"
                    >
                        <Icon name="Plus" />
                        <span className="font-medium">오늘 식단 짜달라고 요청하기</span>
                    </button>

                    {/* AI 요청 입력 필드 */}
                    {showAIInput && (
                        <div className="bg-white border rounded-lg p-4 space-y-3">
                            <textarea
                                ref={textareaRef}
                                placeholder="예: 오늘 식단 짜줘 / 습식이 없어서 건식 위주로 / 어제 잘 안먹어서 오늘은 좀 더 줘도 될듯"
                                className="w-full p-3 border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-purple-500"
                                rows="3"
                                autoFocus
                            />
                            <div className="flex gap-2">
                                <button
                                    onClick={handleAIRequest}
                                    className="flex-1 bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600"
                                >
                                    식단 생성
                                </button>
                                <button
                                    onClick={() => {
                                        setShowAIInput(false);
                                        if (textareaRef.current) {
                                            textareaRef.current.value = '';
                                        }
                                    }}
                                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                >
                                    취소
                                </button>
                            </div>
                        </div>
                    )}

                    {/* 칼로리 및 상태 요약 */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-blue-50 p-4 rounded-lg">
                            <div className="flex items-center justify-between">
                                <span className="text-sm text-gray-600">목표 칼로리</span>
                                <span className="font-bold text-blue-600">{totalPlannedCalories} kcal</span>
                            </div>
                            <div className="flex items-center justify-between mt-2">
                                <span className="text-sm text-gray-600">실제 섭취</span>
                                <span className="font-bold text-green-600">{totalActualCalories} kcal</span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div 
                                    className="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full transition-all"
                                    style={{ width: `${Math.min((totalActualCalories / totalPlannedCalories) * 100, 100)}%` }}
                                />
                            </div>
                        </div>

                        <div className="bg-purple-50 p-4 rounded-lg">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-sm text-gray-600 flex items-center gap-1">
                                    <Icon name="Weight" className="w-4 h-4" /> 오늘 체중
                                </span>
                                <div className="flex items-center gap-1">
                                    <input
                                        type="number"
                                        step="0.01"
                                        value={catInfo.weight}
                                        onChange={(e) => updateWeight(parseFloat(e.target.value) || 0)}
                                        className="w-16 px-2 py-1 border rounded text-right focus:outline-none focus:ring-2 focus:ring-purple-500"
                                        placeholder="0"
                                    />
                                    <span className="text-sm">kg</span>
                                </div>
                            </div>
                            <div className="flex items-center justify-between">
                                <span className="text-sm text-gray-600">수분 섭취</span>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setWaterIntake(0)}
                                        className={`px-3 py-1 rounded text-xs ${waterIntake === 0 ? 'bg-red-500 text-white' : 'bg-gray-200'}`}
                                    >
                                        ❌ 안마심
                                    </button>
                                    <button
                                        onClick={() => setWaterIntake(1)}
                                        className={`px-3 py-1 rounded text-xs ${waterIntake === 1 ? 'bg-yellow-500 text-white' : 'bg-gray-200'}`}
                                    >
                                        💧 조금
                                    </button>
                                    <button
                                        onClick={() => setWaterIntake(2)}
                                        className={`px-3 py-1 rounded text-xs ${waterIntake === 2 ? 'bg-green-500 text-white' : 'bg-gray-200'}`}
                                    >
                                        💧💧 충분
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 화장실 체크 */}
                    <div className="bg-yellow-50 p-3 rounded-lg flex items-center justify-between">
                        <span className="text-sm text-gray-700">오늘 화장실 다녀왔나요?</span>
                        <button
                            onClick={() => setBathroomCheck(!bathroomCheck)}
                            className={`px-4 py-2 rounded-lg font-medium ${
                                bathroomCheck 
                                    ? 'bg-green-500 text-white' 
                                    : 'bg-gray-200 text-gray-600'
                            }`}
                        >
                            💩 {bathroomCheck ? '완료!' : '아직...'}
                        </button>
                    </div>

                    {/* 식사 시간대별 카드 */}
                    {Object.entries(dietPlan).map(([mealTime, meal]) => {
                        const actual = actualIntake[mealTime];
                        const mealCalories = calculateCalories(actual.wet, actual.dry, actual.snack);
                        const icons = {
                            morning: '🌅',
                            snackTime1: '🍼',
                            lunch: '🕛',
                            snackTime2: '🍼',
                            dinner: '🌙',
                            lateNight: '🌃'
                        };
                        const labels = {
                            morning: '아침',
                            snackTime1: '간식1',
                            lunch: '점심',
                            snackTime2: '간식2',
                            dinner: '저녁',
                            lateNight: '야식'
                        };

                        return (
                            <div key={mealTime} className="bg-white border rounded-lg p-4 shadow-sm">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="flex items-center gap-2">
                                        <span className="text-2xl">{icons[mealTime] || '🍽️'}</span>
                                        <div>
                                            <h3 className="font-bold text-lg">{labels[mealTime] || mealTime}</h3>
                                            <p className="text-sm text-gray-500">{meal.time}</p>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => handleMealCheck(mealTime)}
                                        className={`p-2 rounded-full ${
                                            actual.done 
                                                ? 'bg-green-500 text-white' 
                                                : 'bg-gray-200 text-gray-600'
                                        }`}
                                    >
                                        <Icon name="Check" />
                                    </button>
                                </div>

                                <div className="grid grid-cols-3 gap-3 mb-3">
                                    <div>
                                        <label className="text-xs text-gray-600">습식</label>
                                        <div className="flex items-center gap-1">
                                            <span className={`text-lg font-bold ${actual.done ? 'text-green-600' : 'text-gray-400'}`}>
                                                {actual.done ? meal.wet : 0}
                                            </span>
                                            <span className="text-sm text-gray-500">/ {meal.wet}g</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-xs text-gray-600">건식</label>
                                        <div className="flex items-center gap-1">
                                            <span className={`text-lg font-bold ${actual.done ? 'text-green-600' : 'text-gray-400'}`}>
                                                {actual.done ? meal.dry : 0}
                                            </span>
                                            <span className="text-sm text-gray-500">/ {meal.dry}g</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-xs text-gray-600">간식</label>
                                        <div className="flex items-center gap-1">
                                            <span className={`text-lg font-bold ${actual.done ? 'text-green-600' : 'text-gray-400'}`}>
                                                {actual.done ? meal.snack : 0}
                                            </span>
                                            <span className="text-sm text-gray-500">/ {meal.snack}g</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex items-center justify-between">
                                    <p className="text-xs text-gray-500 italic">{meal.notes}</p>
                                    <span className="text-sm font-medium text-purple-600">{mealCalories} kcal</span>
                                </div>
                            </div>
                        );
                    })}

                    {/* 자동 생성된 식단 안내 */}
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2">
                        <p className="text-sm text-blue-800">
                            💡 오늘의 식단은 루의 현재 체중과 나이를 고려해 자동으로 생성되었습니다.
                        </p>
                    </div>
                </div>
            );

            // 리포트 탭
            const ReportTab = () => {
                const [reportPeriod, setReportPeriod] = useState('week');
                
                // 리포트 데이터 계산
                const calculateReportData = (period) => {
                    const now = new Date();
                    let startDate = new Date();
                    
                    switch(period) {
                        case 'week':
                            startDate.setDate(now.getDate() - 7);
                            break;
                        case 'month':
                            startDate.setMonth(now.getMonth() - 1);
                            break;
                        case 'year':
                            startDate.setFullYear(now.getFullYear() - 1);
                            break;
                    }
                    
                    // 기간 내 데이터 필터링
                    const relevantRecords = Object.entries(dailyRecords)
                        .filter(([date]) => new Date(date) >= startDate)
                        .map(([date, record]) => record);
                    
                    // 평균 칼로리
                    const avgCalories = relevantRecords.length > 0
                        ? Math.round(relevantRecords.reduce((sum, r) => sum + (r.totalCalories || 0), 0) / relevantRecords.length)
                        : 0;
                    
                    // 식사 완료율
                    const completionRate = relevantRecords.length > 0
                        ? Math.round((relevantRecords.filter(r => {
                            const meals = Object.values(r.actualIntake || {});
                            return meals.some(m => m.done);
                        }).length / relevantRecords.length) * 100)
                        : 0;
                    
                    // 체중 변화
                    const weights = Object.entries(weightHistory)
                        .filter(([date]) => new Date(date) >= startDate)
                        .sort(([a], [b]) => new Date(a) - new Date(b));
                    
                    const weightChange = weights.length > 1
                        ? (weights[weights.length - 1][1] - weights[0][1]).toFixed(2)
                        : 0;
                    
                    return { avgCalories, completionRate, weightChange, recordCount: relevantRecords.length };
                };
                
                const reportData = calculateReportData(reportPeriod);
                
                return (
                    <div className="space-y-4">
                        <h2 className="text-xl font-bold mb-4">📊 식단 리포트</h2>
                        
                        <div className="grid grid-cols-3 gap-4 mb-6">
                            <button 
                                onClick={() => setReportPeriod('week')}
                                className={`p-4 rounded-lg ${reportPeriod === 'week' ? 'bg-blue-500 text-white' : 'bg-blue-50 hover:bg-blue-100'}`}
                            >
                                <h3 className="font-bold">주간</h3>
                                <p className="text-sm mt-1">최근 7일</p>
                            </button>
                            <button 
                                onClick={() => setReportPeriod('month')}
                                className={`p-4 rounded-lg ${reportPeriod === 'month' ? 'bg-green-500 text-white' : 'bg-green-50 hover:bg-green-100'}`}
                            >
                                <h3 className="font-bold">월간</h3>
                                <p className="text-sm mt-1">최근 30일</p>
                            </button>
                            <button 
                                onClick={() => setReportPeriod('year')}
                                className={`p-4 rounded-lg ${reportPeriod === 'year' ? 'bg-purple-500 text-white' : 'bg-purple-50 hover:bg-purple-100'}`}
                            >
                                <h3 className="font-bold">연간</h3>
                                <p className="text-sm mt-1">최근 12개월</p>
                            </button>
                        </div>

                        {/* 리포트 요약 */}
                        <div className="bg-white border rounded-lg p-4">
                            <h3 className="font-bold mb-3">
                                {reportPeriod === 'week' ? '주간' : reportPeriod === 'month' ? '월간' : '연간'} 요약
                            </h3>
                            <div className="space-y-2">
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">평균 일일 칼로리</span>
                                    <span className="font-medium">{reportData.avgCalories} kcal</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">식사 완료율</span>
                                    <span className="font-medium text-green-600">{reportData.completionRate}%</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">체중 변화</span>
                                    <span className={`font-medium ${reportData.weightChange > 0 ? 'text-blue-600' : reportData.weightChange < 0 ? 'text-red-600' : 'text-gray-600'}`}>
                                        {reportData.weightChange > 0 ? '+' : ''}{reportData.weightChange}kg
                                    </span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">기록된 일수</span>
                                    <span className="font-medium">{reportData.recordCount}일</span>
                                </div>
                            </div>
                        </div>

                        {/* 체중 변화 기록 */}
                        <div className="bg-white border rounded-lg p-4">
                            <h3 className="font-bold mb-3">최근 체중 기록</h3>
                            <div className="space-y-1 max-h-40 overflow-y-auto">
                                {Object.entries(weightHistory)
                                    .sort(([a], [b]) => new Date(b) - new Date(a))
                                    .slice(0, 10)
                                    .map(([date, weight]) => (
                                        <div key={date} className="flex justify-between text-sm">
                                            <span className="text-gray-600">{new Date(date).toLocaleDateString('ko-KR')}</span>
                                            <span className="font-medium">{weight}kg</span>
                                        </div>
                                    ))}
                            </div>
                        </div>

                        {/* 나이 정보 */}
                        <div className="bg-gray-50 rounded-lg p-4 text-center">
                            <p className="text-sm text-gray-600">루의 나이</p>
                            <p className="text-lg font-bold mt-1">{catInfo.age}</p>
                            <p className="text-xs text-gray-500 mt-1">생일: {new Date(catInfo.birthDate).toLocaleDateString('ko-KR')}</p>
                        </div>
                    </div>
                );
            };

            // 설정 탭
            const SettingsTab = () => (
                <div className="space-y-4">
                    <h2 className="text-xl font-bold mb-4">⚙️ 설정</h2>
                    
                    <div className="bg-white border rounded-lg p-4 space-y-4">
                        <h3 className="font-bold">기본 정보</h3>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="text-sm text-gray-600">이름</label>
                                <input
                                    type="text"
                                    value={catInfo.name}
                                    onChange={(e) => setCatInfo({...catInfo, name: e.target.value})}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-600">체중 (kg)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={catInfo.weight}
                                    onChange={(e) => updateWeight(parseFloat(e.target.value))}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-600">생일</label>
                                <input
                                    type="date"
                                    value={catInfo.birthDate}
                                    onChange={(e) => {
                                        const newBirthDate = e.target.value;
                                        setCatInfo({
                                            ...catInfo, 
                                            birthDate: newBirthDate,
                                            age: calculateAge(newBirthDate)
                                        });
                                    }}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-600">목표 칼로리</label>
                                <input
                                    type="number"
                                    value={catInfo.targetCalories}
                                    onChange={(e) => setCatInfo({...catInfo, targetCalories: parseInt(e.target.value)})}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="bg-white border rounded-lg p-4 space-y-4">
                        <h3 className="font-bold">AI 설정 (Gemini)</h3>
                        <div>
                            <label className="text-sm text-gray-600">Gemini API Key</label>
                            <input
                                type="password"
                                value={geminiApiKey}
                                onChange={(e) => {
                                    setGeminiApiKey(e.target.value);
                                    localStorage.setItem('geminiApiKey', e.target.value);
                                }}
                                placeholder="AIza..."
                                className="w-full px-3 py-2 border rounded"
                            />
                            <p className="text-xs text-gray-500 mt-1">
                                <a href="https://makersuite.google.com/app/apikey" target="_blank" className="text-blue-500 underline">
                                    API 키 받기
                                </a> (무료 - Google 계정 필요)
                            </p>
                        </div>
                    </div>

                    <div className="bg-white border rounded-lg p-4 space-y-4">
                        <h3 className="font-bold">알림 설정</h3>
                        <label className="flex items-center gap-2">
                            <input type="checkbox" className="w-4 h-4" defaultChecked />
                            <span className="text-sm">식사 시간 알림</span>
                        </label>
                        <label className="flex items-center gap-2">
                            <input type="checkbox" className="w-4 h-4" defaultChecked />
                            <span className="text-sm">물 교체 리마인더</span>
                        </label>
                        <label className="flex items-center gap-2">
                            <input type="checkbox" className="w-4 h-4" defaultChecked />
                            <span className="text-sm">화장실 체크 알림</span>
                        </label>
                    </div>

                    <div className="bg-white border rounded-lg p-4">
                        <h3 className="font-bold mb-3">데이터 백업/복원</h3>
                        <div className="space-y-3">
                            <div>
                                <button
                                    onClick={() => {
                                        const data = {
                                            catInfo: {
                                                name: catInfo.name,
                                                birthDate: catInfo.birthDate,
                                                weight: catInfo.weight
                                            },
                                            records: dailyRecords,
                                            dietPlan: dietPlan,
                                            lastUpdated: new Date().toISOString()
                                        };
                                        const jsonStr = JSON.stringify(data, null, 2);
                                        const blob = new Blob([jsonStr], { type: 'application/json' });
                                        const url = URL.createObjectURL(blob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = `루_식단_백업_${new Date().toISOString().split('T')[0]}.json`;
                                        a.click();
                                        URL.revokeObjectURL(url);
                                        
                                        // 클립보드에 복사
                                        navigator.clipboard.writeText(jsonStr).then(() => {
                                            alert('✅ 파일 다운로드 완료!\n📋 데이터가 클립보드에도 복사되었습니다.');
                                        });
                                    }}
                                    className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                >
                                    📥 데이터 다운로드 + 복사
                                </button>
                            </div>
                            
                            <div>
                                <label className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 cursor-pointer text-center block">
                                    📤 데이터 업로드
                                    <input
                                        type="file"
                                        accept=".json"
                                        className="hidden"
                                        onChange={(e) => {
                                            const file = e.target.files[0];
                                            if (file) {
                                                const reader = new FileReader();
                                                reader.onload = (event) => {
                                                    try {
                                                        const data = JSON.parse(event.target.result);
                                                        
                                                        // 데이터 복원
                                                        if (data.catInfo) {
                                                            setCatInfo({
                                                                ...data.catInfo,
                                                                age: calculateAge(data.catInfo.birthDate),
                                                                targetCalories: catInfo.targetCalories
                                                            });
                                                        }
                                                        
                                                        if (data.dietPlan) {
                                                            setDietPlan(data.dietPlan);
                                                        }
                                                        
                                                        if (data.records) {
                                                            setDailyRecords(data.records);
                                                            localStorage.setItem('dailyRecords', JSON.stringify(data.records));
                                                        }
                                                        
                                                        alert('✅ 데이터 복원 완료!');
                                                    } catch (error) {
                                                        alert('❌ 파일 읽기 실패');
                                                    }
                                                };
                                                reader.readAsText(file);
                                            }
                                        }}
                                    />
                                </label>
                            </div>
                            
                            <div>
                                <button
                                    onClick={() => {
                                        navigator.clipboard.readText().then(text => {
                                            try {
                                                const data = JSON.parse(text);
                                                if (data.catInfo && data.records) {
                                                    // 데이터 복원
                                                    if (data.catInfo) {
                                                        setCatInfo({
                                                            ...data.catInfo,
                                                            age: calculateAge(data.catInfo.birthDate),
                                                            targetCalories: catInfo.targetCalories
                                                        });
                                                    }
                                                    
                                                    if (data.dietPlan) {
                                                        setDietPlan(data.dietPlan);
                                                    }
                                                    
                                                    if (data.records) {
                                                        setDailyRecords(data.records);
                                                        localStorage.setItem('dailyRecords', JSON.stringify(data.records));
                                                    }
                                                    
                                                    alert('✅ 클립보드에서 데이터 복원 완료!');
                                                } else {
                                                    alert('❌ 올바른 데이터 형식이 아닙니다.');
                                                }
                                            } catch (error) {
                                                alert('❌ 클립보드에 유효한 JSON 데이터가 없습니다.');
                                            }
                                        });
                                    }}
                                    className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
                                >
                                    📋 클립보드에서 붙여넣기
                                </button>
                            </div>
                            
                            <div className="text-xs text-gray-500 bg-yellow-50 p-3 rounded">
                                💡 꿀팁: 매일 자동 알림 설정하기
                                <br />• 스마트폰 알람에 "루 식단 백업" 설정
                                <br />• 데이터를 클립보드에 복사 → 메모앱에 저장
                                <br />• 다른 기기에서는 클립보드로 쉽게 복원
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto bg-gray-50 min-h-screen">
                    {/* 메인 컨텐츠 */}
                    <div className="p-4 pb-20">
                        {activeTab === 'today' && <TodayTab />}
                        {activeTab === 'report' && <ReportTab />}
                        {activeTab === 'settings' && <SettingsTab />}
                    </div>

                    {/* 하단 네비게이션 */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t">
                        <div className="max-w-md mx-auto">
                            <div className="grid grid-cols-3">
                                <button
                                    onClick={() => setActiveTab('today')}
                                    className={`py-3 flex flex-col items-center gap-1 ${
                                        activeTab === 'today' ? 'text-purple-600' : 'text-gray-400'
                                    }`}
                                >
                                    <Icon name="Calendar" />
                                    <span className="text-xs">오늘</span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('report')}
                                    className={`py-3 flex flex-col items-center gap-1 ${
                                        activeTab === 'report' ? 'text-purple-600' : 'text-gray-400'
                                    }`}
                                >
                                    <Icon name="BarChart3" />
                                    <span className="text-xs">리포트</span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('settings')}
                                    className={`py-3 flex flex-col items-center gap-1 ${
                                        activeTab === 'settings' ? 'text-purple-600' : 'text-gray-400'
                                    }`}
                                >
                                    <Icon name="Settings" />
                                    <span className="text-xs">설정</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // React 앱 렌더링
        ReactDOM.render(<CatDietTracker />, document.getElementById('root'));
    </script>
</body>
</html>