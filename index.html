<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë£¨ ì‹ë‹¨ ê´€ë¦¬ ğŸ±</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/lucide@latest/dist/lucide.css">
    <style>
        /* ëª¨ë°”ì¼ ìµœì í™” ìŠ¤íƒ€ì¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .lucide {
            width: 20px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Lucide ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸
        const Icon = ({ name, className = "" }) => {
            const icons = {
                Calendar: "ğŸ“…",
                Weight: "âš–ï¸",
                Droplet: "ğŸ’§",
                Check: "âœ“",
                Plus: "â•",
                BarChart3: "ğŸ“Š",
                Settings: "âš™ï¸"
            };
            return <span className={className}>{icons[name] || "â€¢"}</span>;
        };

        const CatDietTracker = () => {
            // í˜„ì¬ ë‚ ì§œ (KST)
            const today = new Date();
            const dateString = `${today.getMonth() + 1}/${today.getDate()} ${['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][today.getDay()]}ìš”ì¼`;

            // ë£¨ì˜ ë‚˜ì´ ìë™ ê³„ì‚°
            const calculateAge = (birthDate) => {
                const birth = new Date(birthDate);
                const now = new Date();
                const monthDiff = (now.getFullYear() - birth.getFullYear()) * 12 + (now.getMonth() - birth.getMonth());
                const dayDiff = now.getDate() - birth.getDate();
                
                if (monthDiff < 12) {
                    return `${monthDiff}ê°œì›” ${dayDiff > 0 ? Math.floor(dayDiff / 7) + 'ì£¼' : ''}`;
                } else {
                    const years = Math.floor(monthDiff / 12);
                    const months = monthDiff % 12;
                    return `${years}ì‚´ ${months > 0 ? months + 'ê°œì›”' : ''}`;
                }
            };

            // ë£¨ì˜ ê¸°ë³¸ ì •ë³´
            const [catInfo, setCatInfo] = useState({
                name: 'ë£¨',
                birthDate: '2025-03-21',
                weight: 1.78,
                age: calculateAge('2025-03-21'),
                targetCalories: 350
            });

            // ì‹ë‹¨ ê³„íš
            const [dietPlan, setDietPlan] = useState({
                morning: {
                    time: '07:00~09:00',
                    wet: 25,
                    dry: 8,
                    snack: 0,
                    notes: 'ì–´ì œ ëª» ë¨¹ì€ ë¶„ëŸ‰ ê³ ë ¤í•´ì„œ ìŠµì‹ ë¹„ì¤‘ ë†’ì„'
                },
                lunch: {
                    time: '12:00~14:00',
                    wet: 15,
                    dry: 12,
                    snack: 3,
                    notes: 'ì´ˆë¯¸ë‹ˆ íŠ¸ë¦¿ 2~3g (ì„ íƒ) - ì™¸ì¶œ ëŒ€ë¹„ ê±´ì‹ í¬í•¨'
                },
                dinner: {
                    time: '18:00~20:00',
                    wet: 30,
                    dry: 10,
                    snack: 0,
                    notes: 'ì¸„ë¥´ 1/3ê°œ (ì‹ìš• ìœ ë„ìš©, ì„ íƒì‚¬í•­)'
                }
            });

            // ì‹¤ì œ ì„­ì·¨ ê¸°ë¡
            const [actualIntake, setActualIntake] = useState({
                morning: { wet: 0, dry: 0, snack: 0, done: false },
                lunch: { wet: 0, dry: 0, snack: 0, done: false },
                dinner: { wet: 0, dry: 0, snack: 0, done: false }
            });

            // ì²´ì¤‘ ê¸°ë¡ (ë‚ ì§œë³„)
            const [weightHistory, setWeightHistory] = useState(() => {
                const saved = localStorage.getItem('weightHistory');
                return saved ? JSON.parse(saved) : {
                    [today.toISOString().split('T')[0]]: 1.78
                };
            });

            // ì¼ì¼ ì‹ë‹¨ ê¸°ë¡ ì €ì¥
            const [dailyRecords, setDailyRecords] = useState(() => {
                const saved = localStorage.getItem('dailyRecords');
                return saved ? JSON.parse(saved) : {};
            });

            // ì²´ì¤‘ ì—…ë°ì´íŠ¸
            const updateWeight = (newWeight) => {
                const todayKey = today.toISOString().split('T')[0];
                const updatedHistory = {
                    ...weightHistory,
                    [todayKey]: newWeight
                };
                setWeightHistory(updatedHistory);
                localStorage.setItem('weightHistory', JSON.stringify(updatedHistory));
                setCatInfo({...catInfo, weight: newWeight});
            };

            // ìˆ˜ë¶„ ì„­ì·¨ ë° í™”ì¥ì‹¤ (0: ì•ˆë§ˆì‹¬, 1: ì¡°ê¸ˆ, 2: ì¶©ë¶„)
            const [waterIntake, setWaterIntake] = useState(0);
            const [bathroomCheck, setBathroomCheck] = useState(false);

            // í˜„ì¬ íƒ­
            const [activeTab, setActiveTab] = useState('today');

            // AI ì‹ë‹¨ ìƒì„± ìš”ì²­
            const [showAIInput, setShowAIInput] = useState(false);
            const textareaRef = useRef(null);
            const [geminiApiKey, setGeminiApiKey] = useState(() => 
                localStorage.getItem('geminiApiKey') || ''
            );

            // AI ì…ë ¥ì°½ í† ê¸€
            const toggleAIInput = () => {
                setShowAIInput(!showAIInput);
                if (!showAIInput) {
                    setTimeout(() => {
                        if (textareaRef.current) {
                            textareaRef.current.focus();
                        }
                    }, 100);
                }
            };

            // Gemini AI ì‹ë‹¨ ìƒì„±
            const handleAIRequest = async () => {
                const requestText = textareaRef.current?.value || '';
                if (!requestText.trim()) {
                    alert('ìš”ì²­ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                if (!geminiApiKey) {
                    alert('ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    setActiveTab('settings');
                    return;
                }

                try {
                    const prompt = `
ë‹¹ì‹ ì€ ê³ ì–‘ì´ ë£¨ì˜ ì‹ë‹¨ ê´€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
ë£¨ì˜ ì •ë³´:
- ì´ë¦„: ${catInfo.name}
- ì²´ì¤‘: ${catInfo.weight}kg
- ë‚˜ì´: ${catInfo.age} (ìƒì¼: ${catInfo.birthDate})
- í•˜ë£¨ ëª©í‘œ ì¹¼ë¡œë¦¬: ${catInfo.targetCalories}kcal
- í˜„ì¬ ì‹œê°„: ${new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}

ì‚¬ìš©ì ìš”ì²­: "${requestText}"

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì„ ìƒì„±í•´ì£¼ì„¸ìš”. 
ì¤‘ìš”: 
- 3ê°œì›” ì •ë„ì˜ ì•„ê¸° ê³ ì–‘ì´ëŠ” ë³´í†µ í•˜ë£¨ 4-5ë¼ë¥¼ ë¨¹ìŠµë‹ˆë‹¤
- í•„ìš”ì— ë”°ë¼ morning, lunch, dinner ì™¸ì— snackTime1, snackTime2 ë“±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ ì‹ì‚¬ íšŸìˆ˜ë¥¼ ì¡°ì ˆí•˜ì„¸ìš”

ë‹¤ìŒ í˜•ì‹ì˜ JSONìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”. ì„¤ëª…ì´ë‚˜ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ëŠ” í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”:
{
  "morning": {
    "time": "07:00~09:00",
    "wet": 25,
    "dry": 8,
    "snack": 0,
    "notes": "ì°¸ê³ ì‚¬í•­"
  },
  "lunch": {
    "time": "12:00~14:00",
    "wet": 15,
    "dry": 12,
    "snack": 3,
    "notes": "ì°¸ê³ ì‚¬í•­"
  },
  "dinner": {
    "time": "18:00~20:00",
    "wet": 30,
    "dry": 10,
    "snack": 0,
    "notes": "ì°¸ê³ ì‚¬í•­"
  }
}

ì¹¼ë¡œë¦¬ ê³„ì‚°: ìŠµì‹ 1g = 1.2kcal, ê±´ì‹ 1g = 3.5kcal, ê°„ì‹ 1g = 4kcal
ë°˜ë“œì‹œ ìœ íš¨í•œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.`;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${geminiApiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 1000,
                            }
                        })
                    });

                    if (!response.ok) {
                        throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                    }

                    const data = await response.json();
                    const content = data.candidates[0].content.parts[0].text;
                    
                    // JSON ì¶”ì¶œ (ë°±í‹±ì´ë‚˜ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì œê±°)
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('ì˜¬ë°”ë¥¸ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤');
                    }
                    
                    const newDietPlan = JSON.parse(jsonMatch[0]);
                    
                    // ì‹ë‹¨ ì—…ë°ì´íŠ¸
                    setDietPlan(newDietPlan);
                    
                    // actualIntakeë„ ìƒˆë¡œìš´ ì‹ì‚¬ ì‹œê°„ì— ë§ê²Œ ì´ˆê¸°í™”
                    const newActualIntake = {};
                    Object.keys(newDietPlan).forEach(mealTime => {
                        newActualIntake[mealTime] = { wet: 0, dry: 0, snack: 0, done: false };
                    });
                    setActualIntake(newActualIntake);
                    
                    // ì…ë ¥ì°½ ë‹«ê¸°
                    setShowAIInput(false);
                    if (textareaRef.current) {
                        textareaRef.current.value = '';
                    }
                    
                    alert('âœ… ìƒˆë¡œìš´ ì‹ë‹¨ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('AI ìš”ì²­ ì˜¤ë¥˜:', error);
                    alert('âŒ ì‹ë‹¨ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n' + error.message);
                }
            };

            // ì¹¼ë¡œë¦¬ ê³„ì‚° (ëŒ€ëµì ì¸ ê°’)
            const calculateCalories = (wet, dry, snack) => {
                return Math.round(wet * 1.2 + dry * 3.5 + snack * 4);
            };

            // ì´ ê³„íš ì¹¼ë¡œë¦¬
            const totalPlannedCalories = Object.values(dietPlan).reduce((sum, meal) => 
                sum + calculateCalories(meal.wet, meal.dry, meal.snack), 0
            );

            // ì‹¤ì œ ì„­ì·¨ ì¹¼ë¡œë¦¬
            const totalActualCalories = Object.values(actualIntake).reduce((sum, meal) => 
                sum + calculateCalories(meal.wet, meal.dry, meal.snack), 0
            );

            // ì˜¤ëŠ˜ì˜ ê¸°ë¡ ì €ì¥
            useEffect(() => {
                const todayKey = today.toISOString().split('T')[0];
                const todayRecord = {
                    date: todayKey,
                    dietPlan,
                    actualIntake,
                    waterIntake,
                    bathroomCheck,
                    weight: catInfo.weight,
                    totalCalories: totalActualCalories
                };
                
                const updatedRecords = {
                    ...dailyRecords,
                    [todayKey]: todayRecord
                };
                
                setDailyRecords(updatedRecords);
                localStorage.setItem('dailyRecords', JSON.stringify(updatedRecords));
            }, [dietPlan, actualIntake, waterIntake, bathroomCheck, catInfo.weight]);

            // ì‹ì‚¬ ì²´í¬ í•¸ë“¤ëŸ¬
            const handleMealCheck = (mealTime) => {
                setActualIntake(prev => ({
                    ...prev,
                    [mealTime]: {
                        ...prev[mealTime],
                        done: !prev[mealTime].done,
                        wet: !prev[mealTime].done ? dietPlan[mealTime].wet : 0,
                        dry: !prev[mealTime].done ? dietPlan[mealTime].dry : 0,
                        snack: !prev[mealTime].done ? dietPlan[mealTime].snack : 0
                    }
                }));
            };

            // ì˜¤ëŠ˜ì˜ ì‹ë‹¨ íƒ­
            const TodayTab = () => (
                <div className="space-y-4">
                    {/* í—¤ë” ì •ë³´ */}
                    <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg">
                        <div className="flex items-center justify-between">
                            <div>
                                <h2 className="text-2xl font-bold flex items-center gap-2">
                                    ğŸ¾ {catInfo.name} ì‹ë‹¨
                                </h2>
                                <p className="text-sm opacity-90">{dateString}</p>
                            </div>
                            <div className="text-right">
                                <p className="text-sm">ì²´ì¤‘: {catInfo.weight}kg</p>
                                <p className="text-sm">{catInfo.age}</p>
                            </div>
                        </div>
                    </div>

                    {/* AI ì‹ë‹¨ ìƒì„± ë²„íŠ¼ */}
                    <button
                        onClick={toggleAIInput}
                        className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg flex items-center justify-center gap-2 hover:opacity-90"
                    >
                        <Icon name="Plus" />
                        <span className="font-medium">ì˜¤ëŠ˜ ì‹ë‹¨ ì§œë‹¬ë¼ê³  ìš”ì²­í•˜ê¸°</span>
                    </button>

                    {/* AI ìš”ì²­ ì…ë ¥ í•„ë“œ */}
                    {showAIInput && (
                        <div className="bg-white border rounded-lg p-4 space-y-3">
                            <textarea
                                ref={textareaRef}
                                placeholder="ì˜ˆ: ì˜¤ëŠ˜ ì‹ë‹¨ ì§œì¤˜ / ìŠµì‹ì´ ì—†ì–´ì„œ ê±´ì‹ ìœ„ì£¼ë¡œ / ì–´ì œ ì˜ ì•ˆë¨¹ì–´ì„œ ì˜¤ëŠ˜ì€ ì¢€ ë” ì¤˜ë„ ë ë“¯"
                                className="w-full p-3 border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-purple-500"
                                rows="3"
                                autoFocus
                            />
                            <div className="flex gap-2">
                                <button
                                    onClick={handleAIRequest}
                                    className="flex-1 bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600"
                                >
                                    ì‹ë‹¨ ìƒì„±
                                </button>
                                <button
                                    onClick={() => {
                                        setShowAIInput(false);
                                        if (textareaRef.current) {
                                            textareaRef.current.value = '';
                                        }
                                    }}
                                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                >
                                    ì·¨ì†Œ
                                </button>
                            </div>
                        </div>
                    )}

                    {/* ì¹¼ë¡œë¦¬ ë° ìƒíƒœ ìš”ì•½ */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-blue-50 p-4 rounded-lg">
                            <div className="flex items-center justify-between">
                                <span className="text-sm text-gray-600">ëª©í‘œ ì¹¼ë¡œë¦¬</span>
                                <span className="font-bold text-blue-600">{totalPlannedCalories} kcal</span>
                            </div>
                            <div className="flex items-center justify-between mt-2">
                                <span className="text-sm text-gray-600">ì‹¤ì œ ì„­ì·¨</span>
                                <span className="font-bold text-green-600">{totalActualCalories} kcal</span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div 
                                    className="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full transition-all"
                                    style={{ width: `${Math.min((totalActualCalories / totalPlannedCalories) * 100, 100)}%` }}
                                />
                            </div>
                        </div>

                        <div className="bg-purple-50 p-4 rounded-lg">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-sm text-gray-600 flex items-center gap-1">
                                    <Icon name="Weight" className="w-4 h-4" /> ì˜¤ëŠ˜ ì²´ì¤‘
                                </span>
                                <div className="flex items-center gap-1">
                                    <input
                                        type="number"
                                        step="0.01"
                                        value={catInfo.weight}
                                        onChange={(e) => updateWeight(parseFloat(e.target.value) || 0)}
                                        className="w-16 px-2 py-1 border rounded text-right focus:outline-none focus:ring-2 focus:ring-purple-500"
                                        placeholder="0"
                                    />
                                    <span className="text-sm">kg</span>
                                </div>
                            </div>
                            <div className="flex items-center justify-between">
                                <span className="text-sm text-gray-600">ìˆ˜ë¶„ ì„­ì·¨</span>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setWaterIntake(0)}
                                        className={`px-3 py-1 rounded text-xs ${waterIntake === 0 ? 'bg-red-500 text-white' : 'bg-gray-200'}`}
                                    >
                                        âŒ ì•ˆë§ˆì‹¬
                                    </button>
                                    <button
                                        onClick={() => setWaterIntake(1)}
                                        className={`px-3 py-1 rounded text-xs ${waterIntake === 1 ? 'bg-yellow-500 text-white' : 'bg-gray-200'}`}
                                    >
                                        ğŸ’§ ì¡°ê¸ˆ
                                    </button>
                                    <button
                                        onClick={() => setWaterIntake(2)}
                                        className={`px-3 py-1 rounded text-xs ${waterIntake === 2 ? 'bg-green-500 text-white' : 'bg-gray-200'}`}
                                    >
                                        ğŸ’§ğŸ’§ ì¶©ë¶„
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* í™”ì¥ì‹¤ ì²´í¬ */}
                    <div className="bg-yellow-50 p-3 rounded-lg flex items-center justify-between">
                        <span className="text-sm text-gray-700">ì˜¤ëŠ˜ í™”ì¥ì‹¤ ë‹¤ë…€ì™”ë‚˜ìš”?</span>
                        <button
                            onClick={() => setBathroomCheck(!bathroomCheck)}
                            className={`px-4 py-2 rounded-lg font-medium ${
                                bathroomCheck 
                                    ? 'bg-green-500 text-white' 
                                    : 'bg-gray-200 text-gray-600'
                            }`}
                        >
                            ğŸ’© {bathroomCheck ? 'ì™„ë£Œ!' : 'ì•„ì§...'}
                        </button>
                    </div>

                    {/* ì‹ì‚¬ ì‹œê°„ëŒ€ë³„ ì¹´ë“œ */}
                    {Object.entries(dietPlan).map(([mealTime, meal]) => {
                        const actual = actualIntake[mealTime];
                        const mealCalories = calculateCalories(actual.wet, actual.dry, actual.snack);
                        const icons = {
                            morning: 'ğŸŒ…',
                            snackTime1: 'ğŸ¼',
                            lunch: 'ğŸ•›',
                            snackTime2: 'ğŸ¼',
                            dinner: 'ğŸŒ™',
                            lateNight: 'ğŸŒƒ'
                        };
                        const labels = {
                            morning: 'ì•„ì¹¨',
                            snackTime1: 'ê°„ì‹1',
                            lunch: 'ì ì‹¬',
                            snackTime2: 'ê°„ì‹2',
                            dinner: 'ì €ë…',
                            lateNight: 'ì•¼ì‹'
                        };

                        return (
                            <div key={mealTime} className="bg-white border rounded-lg p-4 shadow-sm">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="flex items-center gap-2">
                                        <span className="text-2xl">{icons[mealTime] || 'ğŸ½ï¸'}</span>
                                        <div>
                                            <h3 className="font-bold text-lg">{labels[mealTime] || mealTime}</h3>
                                            <p className="text-sm text-gray-500">{meal.time}</p>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => handleMealCheck(mealTime)}
                                        className={`p-2 rounded-full ${
                                            actual.done 
                                                ? 'bg-green-500 text-white' 
                                                : 'bg-gray-200 text-gray-600'
                                        }`}
                                    >
                                        <Icon name="Check" />
                                    </button>
                                </div>

                                <div className="grid grid-cols-3 gap-3 mb-3">
                                    <div>
                                        <label className="text-xs text-gray-600">ìŠµì‹</label>
                                        <div className="flex items-center gap-1">
                                            <span className={`text-lg font-bold ${actual.done ? 'text-green-600' : 'text-gray-400'}`}>
                                                {actual.done ? meal.wet : 0}
                                            </span>
                                            <span className="text-sm text-gray-500">/ {meal.wet}g</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-xs text-gray-600">ê±´ì‹</label>
                                        <div className="flex items-center gap-1">
                                            <span className={`text-lg font-bold ${actual.done ? 'text-green-600' : 'text-gray-400'}`}>
                                                {actual.done ? meal.dry : 0}
                                            </span>
                                            <span className="text-sm text-gray-500">/ {meal.dry}g</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-xs text-gray-600">ê°„ì‹</label>
                                        <div className="flex items-center gap-1">
                                            <span className={`text-lg font-bold ${actual.done ? 'text-green-600' : 'text-gray-400'}`}>
                                                {actual.done ? meal.snack : 0}
                                            </span>
                                            <span className="text-sm text-gray-500">/ {meal.snack}g</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex items-center justify-between">
                                    <p className="text-xs text-gray-500 italic">{meal.notes}</p>
                                    <span className="text-sm font-medium text-purple-600">{mealCalories} kcal</span>
                                </div>
                            </div>
                        );
                    })}

                    {/* ìë™ ìƒì„±ëœ ì‹ë‹¨ ì•ˆë‚´ */}
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2">
                        <p className="text-sm text-blue-800">
                            ğŸ’¡ ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì€ ë£¨ì˜ í˜„ì¬ ì²´ì¤‘ê³¼ ë‚˜ì´ë¥¼ ê³ ë ¤í•´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            );

            // ë¦¬í¬íŠ¸ íƒ­
            const ReportTab = () => {
                const [reportPeriod, setReportPeriod] = useState('week');
                
                // ë¦¬í¬íŠ¸ ë°ì´í„° ê³„ì‚°
                const calculateReportData = (period) => {
                    const now = new Date();
                    let startDate = new Date();
                    
                    switch(period) {
                        case 'week':
                            startDate.setDate(now.getDate() - 7);
                            break;
                        case 'month':
                            startDate.setMonth(now.getMonth() - 1);
                            break;
                        case 'year':
                            startDate.setFullYear(now.getFullYear() - 1);
                            break;
                    }
                    
                    // ê¸°ê°„ ë‚´ ë°ì´í„° í•„í„°ë§
                    const relevantRecords = Object.entries(dailyRecords)
                        .filter(([date]) => new Date(date) >= startDate)
                        .map(([date, record]) => record);
                    
                    // í‰ê·  ì¹¼ë¡œë¦¬
                    const avgCalories = relevantRecords.length > 0
                        ? Math.round(relevantRecords.reduce((sum, r) => sum + (r.totalCalories || 0), 0) / relevantRecords.length)
                        : 0;
                    
                    // ì‹ì‚¬ ì™„ë£Œìœ¨
                    const completionRate = relevantRecords.length > 0
                        ? Math.round((relevantRecords.filter(r => {
                            const meals = Object.values(r.actualIntake || {});
                            return meals.some(m => m.done);
                        }).length / relevantRecords.length) * 100)
                        : 0;
                    
                    // ì²´ì¤‘ ë³€í™”
                    const weights = Object.entries(weightHistory)
                        .filter(([date]) => new Date(date) >= startDate)
                        .sort(([a], [b]) => new Date(a) - new Date(b));
                    
                    const weightChange = weights.length > 1
                        ? (weights[weights.length - 1][1] - weights[0][1]).toFixed(2)
                        : 0;
                    
                    return { avgCalories, completionRate, weightChange, recordCount: relevantRecords.length };
                };
                
                const reportData = calculateReportData(reportPeriod);
                
                return (
                    <div className="space-y-4">
                        <h2 className="text-xl font-bold mb-4">ğŸ“Š ì‹ë‹¨ ë¦¬í¬íŠ¸</h2>
                        
                        <div className="grid grid-cols-3 gap-4 mb-6">
                            <button 
                                onClick={() => setReportPeriod('week')}
                                className={`p-4 rounded-lg ${reportPeriod === 'week' ? 'bg-blue-500 text-white' : 'bg-blue-50 hover:bg-blue-100'}`}
                            >
                                <h3 className="font-bold">ì£¼ê°„</h3>
                                <p className="text-sm mt-1">ìµœê·¼ 7ì¼</p>
                            </button>
                            <button 
                                onClick={() => setReportPeriod('month')}
                                className={`p-4 rounded-lg ${reportPeriod === 'month' ? 'bg-green-500 text-white' : 'bg-green-50 hover:bg-green-100'}`}
                            >
                                <h3 className="font-bold">ì›”ê°„</h3>
                                <p className="text-sm mt-1">ìµœê·¼ 30ì¼</p>
                            </button>
                            <button 
                                onClick={() => setReportPeriod('year')}
                                className={`p-4 rounded-lg ${reportPeriod === 'year' ? 'bg-purple-500 text-white' : 'bg-purple-50 hover:bg-purple-100'}`}
                            >
                                <h3 className="font-bold">ì—°ê°„</h3>
                                <p className="text-sm mt-1">ìµœê·¼ 12ê°œì›”</p>
                            </button>
                        </div>

                        {/* ë¦¬í¬íŠ¸ ìš”ì•½ */}
                        <div className="bg-white border rounded-lg p-4">
                            <h3 className="font-bold mb-3">
                                {reportPeriod === 'week' ? 'ì£¼ê°„' : reportPeriod === 'month' ? 'ì›”ê°„' : 'ì—°ê°„'} ìš”ì•½
                            </h3>
                            <div className="space-y-2">
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">í‰ê·  ì¼ì¼ ì¹¼ë¡œë¦¬</span>
                                    <span className="font-medium">{reportData.avgCalories} kcal</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">ì‹ì‚¬ ì™„ë£Œìœ¨</span>
                                    <span className="font-medium text-green-600">{reportData.completionRate}%</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">ì²´ì¤‘ ë³€í™”</span>
                                    <span className={`font-medium ${reportData.weightChange > 0 ? 'text-blue-600' : reportData.weightChange < 0 ? 'text-red-600' : 'text-gray-600'}`}>
                                        {reportData.weightChange > 0 ? '+' : ''}{reportData.weightChange}kg
                                    </span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-sm text-gray-600">ê¸°ë¡ëœ ì¼ìˆ˜</span>
                                    <span className="font-medium">{reportData.recordCount}ì¼</span>
                                </div>
                            </div>
                        </div>

                        {/* ì²´ì¤‘ ë³€í™” ê¸°ë¡ */}
                        <div className="bg-white border rounded-lg p-4">
                            <h3 className="font-bold mb-3">ìµœê·¼ ì²´ì¤‘ ê¸°ë¡</h3>
                            <div className="space-y-1 max-h-40 overflow-y-auto">
                                {Object.entries(weightHistory)
                                    .sort(([a], [b]) => new Date(b) - new Date(a))
                                    .slice(0, 10)
                                    .map(([date, weight]) => (
                                        <div key={date} className="flex justify-between text-sm">
                                            <span className="text-gray-600">{new Date(date).toLocaleDateString('ko-KR')}</span>
                                            <span className="font-medium">{weight}kg</span>
                                        </div>
                                    ))}
                            </div>
                        </div>

                        {/* ë‚˜ì´ ì •ë³´ */}
                        <div className="bg-gray-50 rounded-lg p-4 text-center">
                            <p className="text-sm text-gray-600">ë£¨ì˜ ë‚˜ì´</p>
                            <p className="text-lg font-bold mt-1">{catInfo.age}</p>
                            <p className="text-xs text-gray-500 mt-1">ìƒì¼: {new Date(catInfo.birthDate).toLocaleDateString('ko-KR')}</p>
                        </div>
                    </div>
                );
            };

            // ì„¤ì • íƒ­
            const SettingsTab = () => (
                <div className="space-y-4">
                    <h2 className="text-xl font-bold mb-4">âš™ï¸ ì„¤ì •</h2>
                    
                    <div className="bg-white border rounded-lg p-4 space-y-4">
                        <h3 className="font-bold">ê¸°ë³¸ ì •ë³´</h3>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="text-sm text-gray-600">ì´ë¦„</label>
                                <input
                                    type="text"
                                    value={catInfo.name}
                                    onChange={(e) => setCatInfo({...catInfo, name: e.target.value})}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-600">ì²´ì¤‘ (kg)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={catInfo.weight}
                                    onChange={(e) => updateWeight(parseFloat(e.target.value))}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-600">ìƒì¼</label>
                                <input
                                    type="date"
                                    value={catInfo.birthDate}
                                    onChange={(e) => {
                                        const newBirthDate = e.target.value;
                                        setCatInfo({
                                            ...catInfo, 
                                            birthDate: newBirthDate,
                                            age: calculateAge(newBirthDate)
                                        });
                                    }}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-600">ëª©í‘œ ì¹¼ë¡œë¦¬</label>
                                <input
                                    type="number"
                                    value={catInfo.targetCalories}
                                    onChange={(e) => setCatInfo({...catInfo, targetCalories: parseInt(e.target.value)})}
                                    className="w-full px-3 py-2 border rounded"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="bg-white border rounded-lg p-4 space-y-4">
                        <h3 className="font-bold">AI ì„¤ì • (Gemini)</h3>
                        <div>
                            <label className="text-sm text-gray-600">Gemini API Key</label>
                            <input
                                type="password"
                                value={geminiApiKey}
                                onChange={(e) => {
                                    setGeminiApiKey(e.target.value);
                                    localStorage.setItem('geminiApiKey', e.target.value);
                                }}
                                placeholder="AIza..."
                                className="w-full px-3 py-2 border rounded"
                            />
                            <p className="text-xs text-gray-500 mt-1">
                                <a href="https://makersuite.google.com/app/apikey" target="_blank" className="text-blue-500 underline">
                                    API í‚¤ ë°›ê¸°
                                </a> (ë¬´ë£Œ - Google ê³„ì • í•„ìš”)
                            </p>
                        </div>
                    </div>

                    <div className="bg-white border rounded-lg p-4 space-y-4">
                        <h3 className="font-bold">ì•Œë¦¼ ì„¤ì •</h3>
                        <label className="flex items-center gap-2">
                            <input type="checkbox" className="w-4 h-4" defaultChecked />
                            <span className="text-sm">ì‹ì‚¬ ì‹œê°„ ì•Œë¦¼</span>
                        </label>
                        <label className="flex items-center gap-2">
                            <input type="checkbox" className="w-4 h-4" defaultChecked />
                            <span className="text-sm">ë¬¼ êµì²´ ë¦¬ë§ˆì¸ë”</span>
                        </label>
                        <label className="flex items-center gap-2">
                            <input type="checkbox" className="w-4 h-4" defaultChecked />
                            <span className="text-sm">í™”ì¥ì‹¤ ì²´í¬ ì•Œë¦¼</span>
                        </label>
                    </div>

                    <div className="bg-white border rounded-lg p-4">
                        <h3 className="font-bold mb-3">ë°ì´í„° ë°±ì—…/ë³µì›</h3>
                        <div className="space-y-3">
                            <div>
                                <button
                                    onClick={() => {
                                        const data = {
                                            catInfo: {
                                                name: catInfo.name,
                                                birthDate: catInfo.birthDate,
                                                weight: catInfo.weight
                                            },
                                            records: dailyRecords,
                                            dietPlan: dietPlan,
                                            lastUpdated: new Date().toISOString()
                                        };
                                        const jsonStr = JSON.stringify(data, null, 2);
                                        const blob = new Blob([jsonStr], { type: 'application/json' });
                                        const url = URL.createObjectURL(blob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = `ë£¨_ì‹ë‹¨_ë°±ì—…_${new Date().toISOString().split('T')[0]}.json`;
                                        a.click();
                                        URL.revokeObjectURL(url);
                                        
                                        // í´ë¦½ë³´ë“œì— ë³µì‚¬
                                        navigator.clipboard.writeText(jsonStr).then(() => {
                                            alert('âœ… íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!\nğŸ“‹ ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì—ë„ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                        });
                                    }}
                                    className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                >
                                    ğŸ“¥ ë°ì´í„° ë‹¤ìš´ë¡œë“œ + ë³µì‚¬
                                </button>
                            </div>
                            
                            <div>
                                <label className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 cursor-pointer text-center block">
                                    ğŸ“¤ ë°ì´í„° ì—…ë¡œë“œ
                                    <input
                                        type="file"
                                        accept=".json"
                                        className="hidden"
                                        onChange={(e) => {
                                            const file = e.target.files[0];
                                            if (file) {
                                                const reader = new FileReader();
                                                reader.onload = (event) => {
                                                    try {
                                                        const data = JSON.parse(event.target.result);
                                                        
                                                        // ë°ì´í„° ë³µì›
                                                        if (data.catInfo) {
                                                            setCatInfo({
                                                                ...data.catInfo,
                                                                age: calculateAge(data.catInfo.birthDate),
                                                                targetCalories: catInfo.targetCalories
                                                            });
                                                        }
                                                        
                                                        if (data.dietPlan) {
                                                            setDietPlan(data.dietPlan);
                                                        }
                                                        
                                                        if (data.records) {
                                                            setDailyRecords(data.records);
                                                            localStorage.setItem('dailyRecords', JSON.stringify(data.records));
                                                        }
                                                        
                                                        alert('âœ… ë°ì´í„° ë³µì› ì™„ë£Œ!');
                                                    } catch (error) {
                                                        alert('âŒ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨');
                                                    }
                                                };
                                                reader.readAsText(file);
                                            }
                                        }}
                                    />
                                </label>
                            </div>
                            
                            <div>
                                <button
                                    onClick={() => {
                                        navigator.clipboard.readText().then(text => {
                                            try {
                                                const data = JSON.parse(text);
                                                if (data.catInfo && data.records) {
                                                    // ë°ì´í„° ë³µì›
                                                    if (data.catInfo) {
                                                        setCatInfo({
                                                            ...data.catInfo,
                                                            age: calculateAge(data.catInfo.birthDate),
                                                            targetCalories: catInfo.targetCalories
                                                        });
                                                    }
                                                    
                                                    if (data.dietPlan) {
                                                        setDietPlan(data.dietPlan);
                                                    }
                                                    
                                                    if (data.records) {
                                                        setDailyRecords(data.records);
                                                        localStorage.setItem('dailyRecords', JSON.stringify(data.records));
                                                    }
                                                    
                                                    alert('âœ… í´ë¦½ë³´ë“œì—ì„œ ë°ì´í„° ë³µì› ì™„ë£Œ!');
                                                } else {
                                                    alert('âŒ ì˜¬ë°”ë¥¸ ë°ì´í„° í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                                                }
                                            } catch (error) {
                                                alert('âŒ í´ë¦½ë³´ë“œì— ìœ íš¨í•œ JSON ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                                            }
                                        });
                                    }}
                                    className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
                                >
                                    ğŸ“‹ í´ë¦½ë³´ë“œì—ì„œ ë¶™ì—¬ë„£ê¸°
                                </button>
                            </div>
                            
                            <div className="text-xs text-gray-500 bg-yellow-50 p-3 rounded">
                                ğŸ’¡ ê¿€íŒ: ë§¤ì¼ ìë™ ì•Œë¦¼ ì„¤ì •í•˜ê¸°
                                <br />â€¢ ìŠ¤ë§ˆíŠ¸í° ì•ŒëŒì— "ë£¨ ì‹ë‹¨ ë°±ì—…" ì„¤ì •
                                <br />â€¢ ë°ì´í„°ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬ â†’ ë©”ëª¨ì•±ì— ì €ì¥
                                <br />â€¢ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œëŠ” í´ë¦½ë³´ë“œë¡œ ì‰½ê²Œ ë³µì›
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto bg-gray-50 min-h-screen">
                    {/* ë©”ì¸ ì»¨í…ì¸  */}
                    <div className="p-4 pb-20">
                        {activeTab === 'today' && <TodayTab />}
                        {activeTab === 'report' && <ReportTab />}
                        {activeTab === 'settings' && <SettingsTab />}
                    </div>

                    {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t">
                        <div className="max-w-md mx-auto">
                            <div className="grid grid-cols-3">
                                <button
                                    onClick={() => setActiveTab('today')}
                                    className={`py-3 flex flex-col items-center gap-1 ${
                                        activeTab === 'today' ? 'text-purple-600' : 'text-gray-400'
                                    }`}
                                >
                                    <Icon name="Calendar" />
                                    <span className="text-xs">ì˜¤ëŠ˜</span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('report')}
                                    className={`py-3 flex flex-col items-center gap-1 ${
                                        activeTab === 'report' ? 'text-purple-600' : 'text-gray-400'
                                    }`}
                                >
                                    <Icon name="BarChart3" />
                                    <span className="text-xs">ë¦¬í¬íŠ¸</span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('settings')}
                                    className={`py-3 flex flex-col items-center gap-1 ${
                                        activeTab === 'settings' ? 'text-purple-600' : 'text-gray-400'
                                    }`}
                                >
                                    <Icon name="Settings" />
                                    <span className="text-xs">ì„¤ì •</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // React ì•± ë Œë”ë§
        ReactDOM.render(<CatDietTracker />, document.getElementById('root'));
    </script>
</body>
</html>